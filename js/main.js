// Generated by CoffeeScript 1.6.2
(function() {
  $(document).ready(function() {
    var betAmount, handleResults, i, keepRunningCraps, oddsPayout, runCraps, runningTotal, updateRunningTotal, worker, _i;

    betAmount = 5;
    oddsPayout = 30;
    runningTotal = 0;
    handleResults = function(numRolls, numWins, rollResults) {
      var $newDiv, losses, total, winnings, wonOrLost;

      losses = (numRolls - numWins) * betAmount;
      winnings = numWins * betAmount * oddsPayout;
      total = winnings - losses;
      updateRunningTotal(total);
      if (rollResults !== "") {
        $newDiv = $("<div>").html(rollResults).appendTo("body");
        wonOrLost = formatWinOrLoss(total, "Won " + (formatCurrency(total)), "Lost " + (formatCurrency(-total)), "Broke even");
        return $("<label>").text(wonOrLost.text).addClass(wonOrLost.result).appendTo($newDiv);
      }
    };
    worker = new Worker("js/runCraps.js");
    worker.addEventListener("message", function(e) {
      return handleResults(e.data.numRolls, e.data.numWins, e.data.rollResults);
    }, false);
    runCraps = function() {
      return worker.postMessage({
        numRolls: 20,
        onceOrIndefinitely: "once"
      });
    };
    keepRunningCraps = function() {
      return worker.postMessage({
        numRolls: 1,
        onceOrIndefinitely: "indefinitely"
      });
    };
    $(document).on("keyup", function(e) {
      if (e.keyCode === 27) {
        return worker.terminate();
      }
    });
    updateRunningTotal = function(newTotal) {
      var finalWinOrLoss;

      runningTotal += newTotal;
      finalWinOrLoss = formatWinOrLoss(runningTotal, "You're up! You've won a total of " + (formatCurrency(runningTotal)), "There's always next time. You've lost a total of " + (formatCurrency(-runningTotal)), "Hey, you're even. Maybe you should keep betting.");
      return $("footer").text(finalWinOrLoss.text).removeClass().addClass(finalWinOrLoss.result);
    };
    for (i = _i = 1; _i <= 10; i = ++_i) {
      runCraps();
    }
    return keepRunningCraps();
  });

}).call(this);
